/*
    Copyright (C) 2015 Senare

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

    contact : aperfectbot@gmail.com
    
 */
package ao.apbot.drools.core;

import java.util.List;
import java.util.stream.Collectors;

import com.google.common.base.Joiner;
import com.google.common.collect.Lists;

public class Level {

    private static final Integer[] XP = new Integer[] { 0, 1450, 2600, 3100, 4000, 4500, 5000, 5500, 6000, 6500, 7000, 7700, 8300, 8900, 9600, 10400, 11000, 11900, 12700, 13700, 15400, 16400, 17600, 18800, 20100, 21500, 22900, 24500, 26100, 27800, 30900, 33000, 35100, 37400, 39900, 42400, 45100, 47900, 50900, 54000, 57400, 60900, 64500, 68400, 76400, 81000, 85900, 91000, 96400, 101900, 108000, 114300, 120800, 127700, 135000, 142600, 150700, 161900, 167800, 177100, 203500, 214700, 226700, 239100, 251900, 265700, 280000, 294800, 310600, 327000, 344400, 362300, 381100, 401000, 421600, 443300, 508100, 534200, 561600, 590200, 620000, 651000, 683700, 717900, 753500, 790800, 829400, 870000, 912600, 956800, 1003000, 1051300, 1101500, 1153900, 1208800, 1266000, 1325500, 1387700, 1452300, 1519900, 1590300, 1663500, 1739900, 1819600, 1902200, 1988900, 2078600, 2172100, 2269800, 2371100, 2476600, 2586600, 2701000, 2819800, 2943600, 3072400, 3205800, 3345200, 3489700, 3640200, 3796500, 3958900,
            4128000, 4303400, 4485700, 4674800, 4871700, 5075700, 5288100, 5508200, 5736800, 5974600, 6220700, 6474500, 6742200, 7017500, 7303700, 7600100, 7907600, 8227000, 8557700, 8901000, 9256800, 9625800, 10008600, 10405300, 10816600, 11242500, 11684300, 12141900, 12616200, 13107200, 13616100, 14143600, 14689700, 15255300, 15841000, 16447900, 17075800, 17725900, 18399400, 19096100, 19817500, 20564100, 21336600, 22136100, 22963600, 23819700, 24705200, 25621100, 26569000, 27548800, 28562900, 29611100, 30695300, 31816300, 32975100, 34173500, 35412500, 36692500, 38016500, 39484400, 40797700, 42258500, 43768300, 45328100, 46939900, 48604900, 50324600, 52101200, 53936300, 55831600, 57788700, 59810000, 61897000, 64052200, 66277200, 68574400, 70945700, 73393900, 80000, 96000, 115200, 138240, 165888, 199066, 238879, 286654, 343985, 412782, 495339, 594407, 713288, 855946, 1027135, 1232562, 1479074, 1774889, 2129867, 2555840, 0 };

    private static final String[] MISH = new String[] { " 0", "1 2", "2 3 4", "2 4 5", "3 4 5 6 7", "3 4 5 6 7 8", "4 5 6 7 8 9", "4 5 6 7 8 9 10 11", "5 7 8 9 10 11 12", "6 7 8 9 10 11 12 13 14", "6 7 8 9 10 12 13 14 15", "9 10 11 13 14 15 16 17", "7 8 10 11 12 14 15 15 16 17 18", "9 10 11 12 13 15 16 17 18 19", "8 11 12 13 14 16 17 18 19 20 21", "10 12 13 14 15 17 18 19 20 21 22", "9 11 13 14 15 16 18 19 20 21 22 23 24", "16 17 19 20 21 22 23 25", "10 12 14 15 17 18 20 21 22 23 24 25 26 27", "11 13 15 16 18 19 22 23 24 26 28", "16 17 19 20 23 24 25 26 27 29", "12 14 18 21 24 25 27 28 29 30 31", "13 15 17 19 20 22 25 26 27 28 30 32", "18 21 23 26 28 29 31 33 34", "14 16 19 20 22 24 27 29 30 31 32 33 35", "17 21 23 25 28 30 32 34 36 37", "15 20 22 24 26 29 31 33 35 38", "18 21 23 25 27 30 31 32 34 36 37 39", "16 19 22 24 26 28 32 33 34 35 36 38 40 41", "23 27 29 33 35 37 39 42", "17 20 25 28 30 34 36 38 40 41 43 44", "21 24 26 29 31 35 37 39 42 45",
            "18 25 27 32 36 38 40 41 43 46 47", "22 26 28 30 33 37 39 42 44 45 48", "19 23 29 31 34 38 40 41 43 46 49", "27 32 35 39 42 44 47 50 51", "20 24 28 30 33 36 40 41 43 45 46 48 49 52", "21 25 29 31 34 37 42 44 47 50 53 54", "22 32 35 38 43 45 48 51 55", "26 30 33 36 39 44 46 47 49 52 53 56 57", "27 31 34 37 40 45 48 50 51 54 58", "23 32 38 41 46 49 52 55 59", "24 28 33 35 39 42 47 50 53 56 57 60 61", "29 36 43 48 51 54 58 62", "25 34 37 40 44 49 52 55 56 59 63 64", "30 35 38 41 45 50 51 53 54 57 60 61 65", "26 31 36 39 42 46 52 55 58 62 66 67", "43 47 53 56 59 63 68", "27 32 37 40 44 48 54 57 60 61 64 65 69", "33 38 41 45 49 55 58 62 66 70 71", "28 39 42 46 50 56 59 63 67 72", "29 34 43 47 51 57 60 61 64 68 69 73 74", "35 40 44 48 52 58 62 65 66 70 75", "30 41 49 53 59 63 67 71 76 77", "36 42 45 54 60 61 64 68 72 73 78", "31 37 43 46 50 55 62 65 69 74 79", "32 47 51 56 63 66 67 70 71 75 80 81", "38 44 48 52 57 64 68 72 76 77 82", "33 39 45 49 53 58 65 69 73 78 83 84",
            "46 54 59 66 70 74 79 85", "34 40 50 55 60 67 71 75 76 77 80 81 86 87", "41 47 51 56 61 68 72 82 88", "35 48 52 57 62 69 73 74 78 83 89", "42 49 53 58 63 70 71 75 79 84 85 90 91", "36 43 54 59 64 72 76 77 80 81 86 92", "50 65 73 82 87 93 94", "37 44 51 55 60 66 74 78 83 88 89 95", "45 52 56 61 67 75 79 84 90 96 97", "38 53 57 62 68 76 80 81 85 86 91 98", "39 46 58 63 69 77 82 87 92 93 99", "47 54 59 64 70 78 83 88 94 100 101", "40 55 65 71 79 84 89 95 102", "48 56 60 66 72 80 81 85 90 91 96 97 103 104", "41 49 61 67 73 82 86 87 92 98 105", "57 62 68 74 83 88 93 99 106 107", "42 50 58 63 69 75 84 89 94 100 101 108", "51 59 64 76 85 90 95 96 102 109", "43 70 77 86 91 97 103 110 111", "44 52 60 65 71 78 87 92 98 104 105 112", "53 61 66 72 79 88 93 94 99 106 113 114", "45 62 67 73 80 89 95 100 101 107 115", "54 63 68 74 81 90 91 96 102 108 109 116 117", "46 55 69 75 82 92 97 103 110 118", "64 76 77 83 93 98 104 111 119", "47 56 65 70 84 94 99 105 106 112 113 120 121",
            "48 57 66 71 78 85 95 100 101 107 114 122", "72 79 86 96 102 108 115 123 124", "49 58 67 73 87 97 103 109 116 117 125", "59 68 74 80 88 98 104 110 111 118 126 127", "50 69 81 89 99 105 112 119 128", "60 75 82 90 100 101 106 107 113 120 121 129", "51 61 70 76 77 83 91 102 108 114 122 130 131", "52 71 84 92 103 109 115 116 123 132", "62 72 78 85 93 104 110 117 124 125 133 134", "63 73 79 86 94 105 111 118 126 135", "53 87 95 106 112 119 127 136 137", "64 74 80 88 96 107 113 114 120 121 128 129 138", "54 65 75 81 89 97 108 115 122 130 139", "55 76 82 98 109 116 123 131 140 141", "66 83 90 99 110 111 117 124 132 133 142", "56 67 77 84 91 100 112 118 125 126 134 143 144", "78 92 101 113 119 127 135 145", "57 68 79 85 93 102 114 120 121 128 136 137 146 147", "58 69 86 94 103 115 122 129 138 148", "80 87 95 104 116 123 130 131 139 149", "59 70 81 88 96 105 117 124 132 140 141 150 151", "71 82 89 97 106 118 125 133 142 152", "83 98 107 119 126 127 134 143 153 154",
            "60 72 90 99 108 120 121 128 135 136 144 145 155", "61 73 84 91 109 122 129 137 146 156 157", "62 85 92 100 110 123 130 138 147 158", "74 86 93 101 111 124 131 139 148 149 159", "63 75 94 102 112 125 132 140 141 150 160 161", "87 103 113 126 133 134 142 151 162 163", "64 76 88 95 104 114 127 135 143 152 153 164", "77 89 96 105 115 128 136 144 154 165", "65 97 106 116 129 137 145 146 155 166 167", "78 90 98 107 117 130 131 138 147 156 157 168", "66 79 91 99 108 118 132 139 148 169", "92 109 119 133 140 141 149 158 159 170 171", "67 80 93 100 120 134 142 150 151 160 161 172", "68 81 101 110 121 135 143 152 162 173 174", "94 102 111 112 122 136 144 153 163 175", "69 82 95 103 123 137 145 154 164 165 176 177", "83 96 104 113 124 138 146 147 155 156 166 168 178", "70 114 125 139 148 157 167 179", "84 97 105 115 126 140 141 149 158 169 180 181", "71 85 98 106 116 127 142 150 159 170 182", "72 99 107 117 128 143 151 160 161 171 183 184", "86 108 118 129 144 152 162 172 173 185",
            "73 87 100 109 119 130 145 153 154 163 174 186 187", "101 131 146 155 164 175 188", "74 88 102 110 120 132 147 156 165 166 176 177 189", "89 103 111 121 133 148 157 167 178 190 191", "75 112 122 134 149 158 168 179 192", "76 90 104 113 123 135 150 151 159 169 180 181 193 194", "91 105 114 124 136 152 160 161 170 171 182 195", "77 106 125 137 153 162 172 183 196 197", "78 92 115 126 138 154 163 173 184 185 198", "79 93 107 116 127 139 155 164 174 186 199", "108 117 128 140 156 165 175 176 187 200 201", "94 109 118 129 141 157 166 167 177 188 189 202", "95 119 142 158 168 178 190 203 204", "110 130 143 159 169 179 191 205", "80 96 111 120 131 144 160 161 170 180 181 192 193 206 207", "81 97 112 121 132 145 162 171 182 194 208", "82 113 122 133 146 163 172 183 195 209", "98 123 134 147 164 173 174 184 196 197 210 211", "83 99 114 124 135 148 165 175 185 186 198 212", "84 115 136 149 166 176 187 199 213 214", "100 116 125 137 150 167 177 188 200 201 215",
            "85 101 126 138 151 168 178 189 202 216 217", "117 127 139 152 169 179 190 191 203 218", "102 118 128 153 170 171 180 181 192 204 205 219", "86 103 119 129 140 154 172 182 193 206 220", "87 141 155 173 183 194 207", "104 120 130 142 156 174 184 195 196 208 209", "88 105 121 131 143 157 175 185 197 210", "122 132 144 158 176 186 187 198 211", "89 106 123 133 145 159 177 188 199 212 213", "107 134 146 160 178 189 200 201 214", "90 124 147 161 179 190 202 215", "108 125 135 148 162 180 181 191 203 216 217", "91 109 126 136 149 163 182 192 204 218", "92 137 164 183 193 194 205 206 219", "110 127 138 150 165 184 195 207 220", "93 111 128 139 151 166 185 196 208", "129 152 167 186 197 209", "94 112 140 153 168 187 198 210 211", "113 130 141 154 169 188 199 212", "95 131 142 155 170 189 200 201 213", "96 114 132 143 156 171 190 191 202 214", "115 133 144 157 172 192 203 215 216", "97 158 173 193 204 217", "116 134 145 159 174 194 205 218", "98 117 135 146 175 195 206 207 219",
            "136 147 160 176 196 208 220", "99 118 148 161 177 197 209", "119 137 149 162 178 198 210", "100 138 163 179 199 211", "120 139 150 164 180 200 201 212", "121 151 165 181 202 213 214", "140 152 166 182 203 215", "122 141 153 167 183 204 216", "101 123 142 154 168 184 205 217", "103 143 169 185 206 218", "102 124 155 186 207 219", "104 125 144 156 170 187 208 220", "105 145 157 171 188 209", "106 126 146 158 172 189 210 211", "127 159 173 190 212", "107 147 174 191 213", "128 148 160 175 192 214", "108 129 149 161 176 193 215", "162 177 194 216", "109 130 150 163 178 195 217", "131 151 164 179 196 218", "110 152 197 219", "111 132 153 165 180 198 220", "133 166 181 199", "112 154 167 182 200", "134 155 168 183 201", "113 135 156 169 184 202", "185 203", "114 136 157 170 186 204", "137 158 171 172 187 205", "115 159 188 206", "138 173 189 207", "116 139 160 174 208", "161 190 209", "117 140 162 175 191 210", "118 141 163 176 192 211", "142 177 193 212", "164 178 194 213",
            "119 143 165 179 195 214", "120 166 196 215", "144 180 197 216", "121 145 167 181 198 217", "122 168 182 199 218", "146 169 183 219", "123 147 170 184 200 220", "201", "124 148 171 185 202", "149 172 186 203", "125 173 187 204", "126 127 150 188 205", "128 151 174 189 206", "129 175 207", "152 176 190 208 209", "153 191", "177 192", "154 178 193 210", "130 155 179 194 211", "212", "156 180 195 213", "131 157 181 196 214", "132 182 197 215", "133 158 183 198 216", "134 159 199 217", "135 184 218", "160 185 200 219", "161 186 201", "202 220", "136 162 187 203", "163 188 204", "137 189", "138 164 205", "165 190 206", "139 191 207", "166 192 208",
            "140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 167 168 169 170 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220" };

    private static final List<Integer> MOD = Lists.newArrayList(70, 75, 80, 85, 90, 100, 110, 120, 130, 150, 179);

    public static String get(String level) {
        final int lvl = parse(level, 1, 220);

        int minTeamLevel = (int) (Math.floor(lvl * 0.7226) + 1);
        int maxTeamLevel = (int) Math.min(220, Math.floor(lvl * 1.3839));
        int minPvpLevel = (int) Math.max(1, Math.round(lvl * 0.8) - 1);
        int maxPvpLevel = (int) Math.min(220, Math.max(5, lvl + Math.ceil(lvl / 4) + 1));

        String mish = Joiner.on(" ").join(MOD.stream().map(m -> lvl * m / 100).map(m -> m > 250 ? 250 : m).map(m -> m < 1 ? 1 : m).distinct().collect(Collectors.toList()));

        return String.format("<font color=#DEDE42> L <font color=#FFFF00> %d </font>:team %d - %d | PVP %d - %d | %d %s | missions<font color=#66CCFF> %s </font></font>", lvl, minTeamLevel, maxTeamLevel, minPvpLevel, maxPvpLevel, XP[lvl], lvl < 200 ? "XP" : "SK", mish);
    }

    public static String mish(String level) {
        final int lvl = parse(level, 1, 250);
        return String.format("<font color=#DEDE42> QL <font color=#FFFF00> %d </font> missions maybe from these level players (+/- 1):<font color=#66CCFF> %s </font></font>", lvl, MISH[lvl]);
    }

    private static int parse(String level, int min, int max) {
        int lvl = 0;
        try {
            lvl = Integer.valueOf(level);
        } catch (Exception x) {
        }

        lvl = lvl > max ? max : lvl;
        lvl = lvl < min ? min : lvl;

        return lvl;
    }
}
